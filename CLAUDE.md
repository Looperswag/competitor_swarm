# CLAUDE.md - Claude Code 行为规范

## 1. 方案先行，代码在后

在编写任何代码之前，必须先完成以下步骤：

- **描述你的实现方案**：用自然语言说明你打算怎么做、为什么这么做、涉及哪些文件和模块
- **等待我的明确批准**后再动手写代码
- **需求不清时主动提问**：如果发现需求存在歧义、缺少边界条件、或有多种可行方案，必须先提出澄清问题，而不是自行假设

> 原则：宁可多问一个问题，也不要写出方向错误的代码。

## 2. 控制变更范围，保持任务原子化

- 如果一项任务需要修改 **超过 3 个文件**，请先停下来
- 将任务分解为更小的、独立可验证的子任务
- 每个子任务完成后先确认结果，再继续下一个
- 避免一次性大规模重构，优先采用渐进式修改

> 原则：小步快跑，每一步都可回滚、可验证。

## 3. 编码后自审：列出风险与测试建议

每次编写完代码后，主动完成以下自检：

- **列出可能存在的问题**：边界条件、异常处理、性能隐患、兼容性风险等
- **建议相应的测试用例**来覆盖这些潜在问题
- **标注信心水平**：对于不确定的实现，明确说明哪些部分可能需要进一步验证

> 原则：写完代码不是结束，自审通过才算完成。

## 4. Bug 修复遵循 TDD 流程

当发现或需要修复 bug 时：

1. **先编写一个能稳定复现该 bug 的测试用例**
2. 确认测试失败（证明 bug 确实存在）
3. 修改代码，反复迭代
4. **直到测试通过为止**
5. 确保修复不会引入新的回归问题

> 原则：没有复现测试的 bug 修复是不完整的。

## 5. 持续学习：被纠正后更新规则

- 每次我纠正你的错误或指出更好的做法时，**主动建议将新规则添加到本文件中**
- 提出具体的规则文本供我确认
- 确保同类错误不会再次发生

> 原则：犯错不可怕，重复犯同样的错才可怕。

---

## 6. 通用编码规范

- 优先使用清晰可读的代码，而非过度精巧的实现
- 添加必要的注释，特别是解释"为什么"而非"做了什么"
- 遵循项目已有的代码风格和命名约定
- 涉及 API 调用或外部依赖时，注意错误处理和超时机制

## 7. 沟通风格

- 回答简洁直接，避免不必要的寒暄和重复
- 默认使用中文进行对话和代码注释，除非我明确指定使用其他语言
- 给出建议时说明理由，而非仅给结论
- 不确定时明确表达不确定，而非编造答案
